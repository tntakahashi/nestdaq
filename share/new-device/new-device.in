#!/usr/bin/env bash

PREFIX=""
DEVICE=""

print_help() {
cat << EOS
Usage: $(basename "$0") [options]

Options:
  -p,--prefix        A perfix that points to the installation directory
  -d,--device        device name. 
                     If there are multiple devices, use "A;B;C" like in a cmake list.
  -h,--help          Show this help message
EOS
}

if [[ $# -eq 0 ]]; then
  print_help
  exit 0
fi

while [[ $# -gt 0 ]]; do
  case "$1"  in
    -p|--prefix)
      PREFIX="$2"
      shift 2
      ;;
    --prefix=*)
      PREFIX="${1#*=}"
      shift
      ;;
    -d|--device)
      DEVICE="$2"
      shift 2
      ;;
    --device=*)
      DEVICE="${1#*=}"
      shift
      ;;
    -h|--help)
      print_help
      exit 0
      ;;
    --)
      shift
      break
      ;;
    -*)
      echo "Unknown option: $1"
      exit 1
      ;;
    *)
      echo "Positional argument: $1"
      shift
      ;;
  esac
done

# echo "PREFIX = ${PREFIX}"
# echo "DEVICE = ${DEVICE}"

#echo \
cmake \
  -DCMAKE_INSTALL_PREFIX=${PREFIX} \
  -DDevice=${DEVICE} \
  -P ./new-device/create_skeleton_device.cmake

#-P @CMAKE_INSTALL_FULL_DATADIR@/new-device/create_skeleton_device.cmake