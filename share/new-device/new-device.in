#!/usr/bin/env bash

PREFIX=$(pwd)/my_nestdaq_impl
PROJECT="my_nestdaq_impl"
DEVICE=""

print_help() {
cat << EOS
Usage: $(basename "$0") [options]

Options:
  --prefix           Perfix that points to the directory path to which files are output
                     (default = <current working directory>/my_nestdaq_impl)
  --project          Project name used in cmake.
                     (default = my_nestdaq_impl)
  --device           NestDAQ Device name. 
                     If there are multiple devices, use "A;B;C" like in a cmake list.
  -h,--help          Show this help message
EOS
}

if [[ $# -eq 0 ]]; then
  print_help
  exit 0
fi

while [[ $# -gt 0 ]]; do
  case "$1"  in
    -p|--prefix)
      PREFIX="$2"
      shift 2
      ;;
    --prefix=*)
      PREFIX="${1#*=}"
      shift
      ;;
    --project)
      PROJECT="$2"
      shift 2
      ;;
    --project=*)
      PROJECT="${1#*=}"
      shift
      ;;
    -d|--device)
      DEVICE="$2"
      shift 2
      ;;
    --device=*)
      DEVICE="${1#*=}"
      shift
      ;;
    -h|--help)
      print_help
      exit 0
      ;;
    --)
      shift
      break
      ;;
    -*)
      echo "Unknown option: $1"
      exit 1
      ;;
    *)
      echo "Positional argument: $1"
      shift
      ;;
  esac
done

if [[ -z "$DEVICE" ]]; then
  echo "Error: --device option is not set."
  print_help
  exit 1
fi

if [[ -z "$PROJECT" ]]; then
  echo "Error: --project option is not set."
  print_help
  exit 1
fi

# echo "PREFIX  = ${PREFIX}"
# echo "PROJECT = ${PROJECT}"
# echo "DEVICE  = ${DEVICE}"

#echo \
cmake \
  -DCMAKE_INSTALL_PREFIX=${PREFIX} \
  -DProject=${PROJECT} \
  -DDevice=${DEVICE} \
  -P @CMAKE_INSTALL_FULL_DATADIR@/new-device/create_skeleton_device.cmake
